apiVersion: jobset.x-k8s.io/v1alpha2
kind: JobSet
metadata:
  name: jobset-sample
spec:
  replicatedJobs:
    - name: leaders
      replicas: 1
      template:
        spec:
          template:
            spec:
              containers:
              - name: leader
                image: busybox
                command: ["/bin/sh"]
                args: ["-c", "echo 'start'; sleep 10; echo 'end'"]
    - name: workers
      replicas: 2
      template:
        spec:
          backoffLimit: 0
          template:
            spec:
              containers:
              - name: worker
                image: busybox
                command: ["/bin/sh"]
                args:
                  - "-c"
                  - |
                    echo 'start'
                    sleep 10
                    if [ $((RANDOM % 2)) -eq 0 ]; then
                      echo 'failed'
                      exit 1
                    else
                      echo 'success'
                    fi
      dependsOn:
      - name: leaders
        status: Ready
  successPolicy:
    operator: All
    targetReplicatedJobs:
      - workers
